<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.25" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/ios-training/favicon.ico"><link rel="manifest" href="/ios-training/manifest.webmanifest"><meta name="theme-color" content="#2176d6"><meta name="mobile-web-app-capable" content="yes"><title>Data manipulation | iOS Training</title><meta name="description" content="iOS training docs">
    <link rel="preload" href="/ios-training/assets/style-DTZ0DTB9.css" as="style"><link rel="stylesheet" href="/ios-training/assets/style-DTZ0DTB9.css">
    <link rel="modulepreload" href="/ios-training/assets/app-H6ZQ3zEr.js"><link rel="modulepreload" href="/ios-training/assets/index.html-BRKmZtvS.js">
    
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/ios-training/"><img class="vp-site-logo" src="/ios-training/logo.png" alt="iOS Training"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">iOS Training</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/worldline/ios-training" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/worldline/ios-training" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ios-training/" aria-label="Welcome"><!--[--><!--[--><!--]--><!--]-->Welcome<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ios-training/presentation/" aria-label="Presentation"><!--[--><!--[--><!--]--><!--]-->Presentation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ios-training/swift-part1/" aria-label="Swift (part 1)"><!--[--><!--[--><!--]--><!--]-->Swift (part 1)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ios-training/swift-part2/" aria-label="Swift (part 2)"><!--[--><!--[--><!--]--><!--]-->Swift (part 2)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ios-training/swiftui/" aria-label="SwiftUI"><!--[--><!--[--><!--]--><!--]-->SwiftUI<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/ios-training/data-manipulation/" aria-label="Data manipulation"><!--[--><!--[--><!--]--><!--]-->Data manipulation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ios-training/mini-project/" aria-label="Mini project"><!--[--><!--[--><!--]--><!--]-->Mini project<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/ios-training/to-go-further/" aria-label="Going further"><!--[--><!--[--><!--]--><!--]-->Going further<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="data-manipulation" tabindex="-1"><a class="header-anchor" href="#data-manipulation"><span>Data manipulation</span></a></h1><div class="hint-container tip"><p class="hint-container-title">Estimated time</p><p>1/2 day</p></div><h2 id="http-client" tabindex="-1"><a class="header-anchor" href="#http-client"><span>Http Client</span></a></h2><p>Communicating with a REST API relies on multiple concepts that we&#39;ll cover briefly below:</p><ul><li><a href="https://www.json.org/json-en.html" target="_blank" rel="noopener noreferrer">JSON</a>: a standard data interchange format used a lot in the HTTP messages of REST APIs.</li><li><a href="https://www.redhat.com/en/topics/api/what-is-a-rest-api" target="_blank" rel="noopener noreferrer">REST API</a>: it is a standard communication interface between a client and conforms to the constraints of REST architectural style. In a REST API, HTTP messages are stateless and use JSON data format.</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages" target="_blank" rel="noopener noreferrer">HTTP messages</a>: an http message is a textual message that contains different parts and can be either a request or a response. A request is the HTTP message that the client sends to the server and response is the HTTP message that the server sends to the client in reaction to the request. Both requests and responses have a part called a <em>body</em>. In rest APIs, the body is generally formatted in JSON.</li><li><a href="https://developer.apple.com/documentation/swift/codable" target="_blank" rel="noopener noreferrer">Codable</a>: it is a type that can convert itself into and out of an external representation. It is equivalent to <code>Serializable</code> in Java. This type is helpful if we want to convert an object into an out of a JSON string.</li><li><code>async</code> and <code>await</code>: these keywords are used to call an asynchronous function using a synchronous coding fashion. This means that callbacks are needed no more!</li><li><a href="https://developer.apple.com/documentation/foundation/urlsession" target="_blank" rel="noopener noreferrer">URLSession</a>: The official iOS HTTP client which is part of the Foundation library. This library is not part of the Swift standard library but there is an implementation for non-Apple platforms which is called <a href="https://github.com/apple/swift-corelibs-foundation" target="_blank" rel="noopener noreferrer">swift-corelibs-foundation</a>.</li></ul><p>A typical post request that send and receives a JSON body looks like this:</p><p>First, we define the request and response body objects that conform to <code>(En/De)Codable</code>. We also define the error enum that represents the different errors that can happen.</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token comment">// Codable allows to serialize to JSON</span></span>
<span class="line"><span class="token keyword">struct</span> <span class="token class-name">RequestBody</span><span class="token punctuation">:</span> <span class="token class-name">Encodable</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> prop<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Codable allows to deserialize to JSON</span></span>
<span class="line"><span class="token keyword">struct</span> <span class="token class-name">ResponseBody</span><span class="token punctuation">:</span> <span class="token class-name">Decodable</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> prop<span class="token punctuation">:</span> <span class="token class-name">String</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Error enum to represent the different errors that can happen</span></span>
<span class="line"><span class="token keyword">enum</span> <span class="token class-name">AppError</span><span class="token punctuation">:</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">case</span> incorrectUrl</span>
<span class="line">  <span class="token keyword">case</span> encodingFailed</span>
<span class="line">  <span class="token keyword">case</span> emptyResponseBody</span>
<span class="line">  <span class="token keyword">case</span> <span class="token function">decodingFailed</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, we define the function that sends the request and receives the response.</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">func</span> <span class="token function-definition function">postBody</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">:</span> <span class="token class-name">RequestBody</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">AppError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Create the URL object (which can fail if the string in not a valid URL for example)</span></span>
<span class="line">  <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;https://.../api&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token punctuation">.</span>incorrectUrl<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// Create the request object</span></span>
<span class="line">  <span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token class-name">URLRequest</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> url<span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// Set the method and some headers</span></span>
<span class="line">  request<span class="token punctuation">.</span>httpMethod <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;POST&quot;</span></span></span>
<span class="line">  request<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;application/json&quot;</span></span><span class="token punctuation">,</span> forHTTPHeaderField<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Content-Type&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  request<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;application/json&quot;</span></span><span class="token punctuation">,</span> forHTTPHeaderField<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Accept&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// Encode the request body</span></span>
<span class="line">  <span class="token keyword">let</span> encoded <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">JSONEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">guard</span> <span class="token keyword">let</span> encoded <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token punctuation">.</span>encodingFailed<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// set the body of the request to a byte array (called Data in Swift)</span></span>
<span class="line">  request<span class="token punctuation">.</span>httpBody <span class="token operator">=</span> encoded</span>
<span class="line">  <span class="token comment">// Send the request and wait for the response. This return an optional tuple (data, response)?</span></span>
<span class="line">  <span class="token keyword">let</span> responseTuple <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token keyword">await</span> <span class="token class-name">URLSession</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> request<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">guard</span> <span class="token keyword">let</span> responseTuple <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token punctuation">.</span>emptyResponseBody<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// Extract the data from the tuple if it is not nil</span></span>
<span class="line">  <span class="token keyword">let</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token omit keyword">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> responseTuple</span>
<span class="line">  <span class="token comment">// Decode the response body into a ResponseBody object</span></span>
<span class="line">  <span class="token keyword">let</span> decoded <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ResponseBody</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> data<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">guard</span> <span class="token keyword">let</span> decoded <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Try to decode the data into a string to provide more information about the error</span></span>
<span class="line">    <span class="token keyword">let</span> stringBody <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> data<span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">decodingFailed</span><span class="token punctuation">(</span>stringBody <span class="token operator">??</span> <span class="token string-literal"><span class="token string">&quot;Cannot decode to string&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// Return the information we want from the decoded object or the whole object if needed</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>decoded<span class="token punctuation">.</span>prop<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example of calling the function</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">postBody</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">:</span> <span class="token class-name">RequestBody</span><span class="token punctuation">(</span>prop<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;value&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">switch</span> result <span class="token punctuation">{</span></span>
<span class="line"><span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">let</span> prop<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Success: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">prop</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">decodingFailed</span><span class="token punctuation">(</span><span class="token keyword">let</span> responseBody<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment">// we can use the response body to understand what went wrong in case of decoding error</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Decoding Error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">responseBody</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">failure</span><span class="token punctuation">(</span><span class="token keyword">let</span> error<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;Error: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">error</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="exercises" tabindex="-1"><a class="header-anchor" href="#exercises"><span>Exercises</span></a></h3><ul><li><a href="https://swiftfiddle.com/oyn7ii7dvne37h5uqiqoti5xou" target="_blank" rel="noopener noreferrer">Please click on this link to view the exercise</a></li></ul><details class="hint-container details"><summary>Please open to see the solution(s)</summary><p><a href="https://swiftfiddle.com/7fsyuiu5fzdwtj2dhenxx3x5xm" target="_blank" rel="noopener noreferrer">Solution</a></p></details><ul><li>Show a list of songs fetched from iTunes&#39;s API: <a href="https://itunes.apple.com/search?term=bernard+minet&amp;entity=song" target="_blank" rel="noopener noreferrer">https://itunes.apple.com/search?term=bernard+minet&amp;entity=song</a><ul><li>You can use <a href="https://jsonformatter.org/" target="_blank" rel="noopener noreferrer">jsonformatter.org</a> to format the response of the API and understand its structure.</li><li>A solution is provided by <a href="https://www.hackingwithswift.com/books/ios-swiftui/sending-and-receiving-codable-data-with-urlsession-and-swiftui" target="_blank" rel="noopener noreferrer">hackingwithswift</a>.</li></ul></li></ul><h2 id="data-persistence" tabindex="-1"><a class="header-anchor" href="#data-persistence"><span>Data persistence</span></a></h2><p>Persisting data locally consists of keeping app data after the app has been killed and the variables removed from memory. The persisted data offers many advantages. We can use it to show initial data when the app starts and waits for the first batch data to be fetched from the server. It can also be used to allow for offline app usage.</p><div class="hint-container warning"><p class="hint-container-title">iOS isolates app data from other apps</p><p>For security reasons, each app is isolated from the rest of the apps. This is called sandboxing. <a href="https://medium.com/@dinesh.kachhot/different-ways-to-share-data-between-apps-de75a0a46d4a" target="_blank" rel="noopener noreferrer">This article</a> shows the different ways that allow two or more apps to share their data</p></div><p>There are many ways to persist data in SwiftUI that we cover below.</p><h3 id="userdefaults" tabindex="-1"><a class="header-anchor" href="#userdefaults"><span>UserDefaults</span></a></h3><p>It is a very simple key-value storage that persists data in a file. The API surface is very small and the developer does not need to manage the persisted file. This makes this technique very efficient for simple storage use cases. You can find a short <a href="https://www.hackingwithswift.com/books/ios-swiftui/storing-user-settings-with-userdefaults" target="_blank" rel="noopener noreferrer">guide here</a>.</p><p>Here is sample code that shows how to persist and load data.</p><div class="language-swift line-numbers-mode" data-highlighter="prismjs" data-ext="swift"><pre><code class="language-swift"><span class="line"><span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>tapCount<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Tap&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> tapCount <span class="token operator">=</span> <span class="token class-name">UserDefaults</span><span class="token punctuation">.</span>standard<span class="token punctuation">.</span><span class="token function">integer</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Tap&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="codable-saved-in-a-file" tabindex="-1"><a class="header-anchor" href="#codable-saved-in-a-file"><span><code>Codable</code> saved in a file</span></a></h3><p>A more advanced and powerful technique is to manually load and persist a <code>Codable</code> into a file. This technique is useful if you want to store complex objects (such as the state or model) in a JSON file. There are two steps in this process, the first one consists of decoding / encoding the object from / into JSON using <code>JSONDecoder().decode</code> and <code>JSONEncoder().encode</code>. The second step consists of loading / saving the encoded data and we can think of two ways to achieve this. The first one consists of user defaults&#39; <code>dataForKey:</code> to load the data and <code>setObject:ForKey</code> to persist it. Another one consists of creating and managing a file by the developer using file APIs such as <code>fileHandle.availableData</code> to load the data from a file and <code>data.write</code> to save it.</p><h3 id="swift-data" tabindex="-1"><a class="header-anchor" href="#swift-data"><span>Swift Data</span></a></h3><p>Swift Data is a framework introduced by Apple since iOS 17.0 to simplify data management in Swift applications. It inherits many concepts from Core Data (read more about Core Data below) but it is more straightforward to use.</p><p>This project shows an example of using <a href="https://github.com/worldline/ios-training/tree/main/samples/SwiftData-01.swiftpm" target="_blank" rel="noopener noreferrer">Swift Data in a SwiftUI application</a>.</p><h3 id="data-persistence-libraries" tabindex="-1"><a class="header-anchor" href="#data-persistence-libraries"><span>Data persistence libraries</span></a></h3><p>For storing data in a database or similar fashion, SQLite is available as a low level library. It is not recommended to use it unless there is a strong performance concern. Instead, it is recommended to use libraries specialized in data persistence. Some can be assimilated to an ORM library (Object Relational Mapper). The remainder of this section describes some of them.</p><div class="hint-container warning"><p class="hint-container-title">Please be careful about the pricing of cloud storage</p><p>Sophisticated databases generally provide cloud storage to provide a complete offer. If you&#39;re interested in storing data in the cloud, please take some time to read the pricing page to avoid any bad surprises when your app runs in production.</p></div><h4 id="firebase-datastore" tabindex="-1"><a class="header-anchor" href="#firebase-datastore"><span>Firebase datastore</span></a></h4><p>Firebase datastore is a cloud first database. This means that Firebase Datastore requires an internet connection to store and load the data. However, the library is simple to use and supports real time updates.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Firebase datastore is part of a bigger suite of service called Firebase. For example, we can <em>Firebase App Distribution</em> in Firebase, which is a service that allows to deploy and distribute apps without going the burden of using TestFlight.</p></div><h4 id="core-data-legacy" tabindex="-1"><a class="header-anchor" href="#core-data-legacy"><span>Core Data (legacy)</span></a></h4><p><a href="https://developer.apple.com/documentation/coredata" target="_blank" rel="noopener noreferrer">Core Data</a> is the official library to &quot;Persist or cache data on a single device, or sync data to multiple devices with CloudKit&quot;. It existed since iOS 3 and Apple continuously updates it to keep it relevant. It also has the reputation of having a steep learning curve, but it remains famous among developers.</p><p>It works similarly as an ORM where classes are mapped into tables. Xcode provides a graphical editor that allows to specify the tables, the relations and generate the necessary code (in Swift or Objective-C).</p><figure><img src="https://docs-assets.developer.apple.com/published/fbb9767e96/rendered2x-1622022015.png" alt="Core date editor" tabindex="0" loading="lazy"><figcaption>Core date editor</figcaption></figure><p>Even though Core Date existed before SwiftUI, Apple made sure that both of them can be used together. This article shows <a href="https://www.hackingwithswift.com/books/ios-swiftui/how-to-combine-core-data-and-swiftui" target="_blank" rel="noopener noreferrer">how to use Core Data in a SwiftUI project</a>.</p><h4 id="realm-atlas-device-deprecated" tabindex="-1"><a class="header-anchor" href="#realm-atlas-device-deprecated"><span>Realm / Atlas Device (deprecated)</span></a></h4><p><a href="https://realm.io/" target="_blank" rel="noopener noreferrer">Realm</a> is a high level alternative to SQLite. It can be seen as alternative to Core Data as they seem to provide a similar list of features. Most notably, the possibility to store data locally or in the cloud. The points where Realm wins is that the library seems simpler to learn and to use and that it is also available in Android.</p><h3 id="pw-complete-the-official-ios-persisting-data-tutorial" tabindex="-1"><a class="header-anchor" href="#pw-complete-the-official-ios-persisting-data-tutorial"><span>PW: complete the official iOS persisting data tutorial</span></a></h3><p>This PW shows how to save a <code>Codable</code> in a manually managed file using JSON encoder and filesystem APIs.</p><p><a href="https://developer.apple.com/tutorials/app-dev-training/persisting-data" target="_blank" rel="noopener noreferrer">https://developer.apple.com/tutorials/app-dev-training/persisting-data</a></p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/worldline/ios-training/edit/main/data-manipulation/README.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><time class="meta-item-info" datetime="2025-10-03T12:59:01.000Z" data-allow-mismatch>10/3/25, 12:59 PM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1958676+yostane@users.noreply.github.com">yostane</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/ios-training/swiftui/" aria-label="SwiftUI"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">SwiftUI</span></div><!--]--></a><a class="route-link auto-link next" href="/ios-training/mini-project/" aria-label="Mini project"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Mini project</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/ios-training/assets/app-H6ZQ3zEr.js" defer></script>
  </body>
</html>
